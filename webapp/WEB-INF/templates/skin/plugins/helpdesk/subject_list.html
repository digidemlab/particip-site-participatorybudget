<#macro subjectsList items typeList depth>
  <#if items?has_content>
    <ul id="${typeList}">
      <#list items as subject>
        <li>
          <#if typeList !="subject">
            <h2 class="sub-title">${subject.text}
              <#if typeList !="subject">
                <a class="top btn btn-lt-bg btn-sm" href="jsp/site/Portal.jsp?page=${path_label}&faq_id=${faq.id}#top">
                  <i class="fa fa-arrow-up"></i>
                </a>
              </#if>
            </h2>
            <a name="${anchor_subject}${subject.id}"></a>
            <ul id="${typeList}">
              <#list subject.questions as questionAnswer>
                <#if questionAnswer.enabled==true>
                  <li>
                    <a name="${anchor_question_answer}${questionAnswer.idQuestionAnswer}"></a>
                    <h3 class="title2">${questionAnswer.question}</h3>
                    <blockquote>${questionAnswer.answer}</blockquote>
                  </li>
                </#if>
              </#list>
            </ul>
            <#else>
              <h4 class="title1">&nbsp;${subject.text}&nbsp;
                <a class="btn btn-xs btn-primary" href="jsp/site/Portal.jsp?page=${path_label}&faq_id=${faq.id}#${anchor_subject}${subject.id}">
                  <i class="fa fa-tag"></i>
                </a>
              </h4>
          </#if>

          <#assign child_subjects_list=subject.getChilds(plugin) />
          <#if child_subjects_list?has_content>
            <@subjectsList items=child_subjects_list typeList=typeList depth=depth+1 />
          </#if>
        </li>
      </#list>
    </ul>
  </#if>
</#macro>

<#macro subjectsListSelect items default_value exclude_value depth>
  <#if items?has_content>
    <#list items as subject>
      <#if exclude_value="${subject.id}">
      <#else>
        <option <#if default_value="${subject.id}">selected="selected"</#if> value="${subject.id}">
        <#if depth &gt; 0>
          <#list 1..depth as i>&nbsp;&nbsp;</#list>
        </#if>${subject.text}</option>
        <#assign child_subjects_list=subject.getChilds(plugin) />
        <#if child_subjects_list?has_content>
          <@subjectsListSelect items=child_subjects_list default_value=default_value exclude_value=exclude_value depth=depth+1 />
        </#if>
      </#if>
    </#list>
  </#if>
</#macro>

<#macro getParentSubject subject breadcrumb>
  <#if subject?has_content>
    <#if breadcrumb=="">
      <#assign breadcrumbCopy=subject.text />
      <#else>
        <#assign breadcrumbCopy=subject.text + " &gt; " + breadcrumb />
    </#if>
    <#if subject.getParent(plugin)?has_content && subject.idParent !=0>
      <@getParentSubject subject=subject.getParent(plugin) breadcrumb=breadcrumbCopy />
      <#else>
        <a class="top btn btn-lt-bg btn-sm" href="jsp/site/Portal.jsp?page=${path_label}&faq_id=${faq.id}#top">
          <i class="fa fa-arrow-up"></i>
        </a>
        ${breadcrumbCopy}
    </#if>
  </#if>
</#macro>

<div id="faq">
	<a id="top"></a>
	
	<#-- *********************************************************************************** -->
	<#-- * FORM FORM FORM FORM FORM FORM FORM FORM FORM FORM FORM FORM FORM FORM FORM FORM * -->
	<#-- * FORM FORM FORM FORM FORM FORM FORM FORM FORM FORM FORM FORM FORM FORM FORM FORM * -->
	<#-- *********************************************************************************** -->

	<div id="search-form" class="container-fluid">
		
		<h2 class="visuallyhidden">Barre de recherche</h2>
	
		<h1 class="text-center">#i18n{helpdesk.subject_list.pageTitle}</h1>
	
		<form class="form" name="form_search" method="post">
			
			<#-- Barre de recherche, avec fond bleu moyen -->
			<div class="container-fluid bg-color7">
				
				<div id="search-form-faq-fields" class="container">
	
					<#-- Recherche par mot clé -->
					<div class="form-group">
						<input type="text" class="form-control" id="form_search_keywords" name="form_search_keywords" value="${filter_searched_keywords?html}" placeholder="Mot(s) à rechercher">
					</div>
					<div class="clearfix"></div>
	
					<#-- Recherche par sujet et sous-sujet-->
					<div class="form-group row">
						<div class="col-md-6">
							<label class="select">
								<select id="form_search_subject_id" name="form_search_subject_id" class="form-control">
									<option value="">Sujet</option>
									<@subjectsListSelect items=helpdesk_subject_list default_value="${filter_subject_id}" exclude_value="" depth=0 />
								</select>
							</label>
							<p class="help-block"></p>
							<div class="clearfix"></div>
						</div>
						<div class="col-md-6">
							<div class="checkbox form-control">
								<label>
									<input type="checkbox" name="form_search_sub_subjects" id="form_search_sub_subjects" value="true" <#if filter_search_sub_subject>checked="checked"</#if>/>
									#i18n{helpdesk.subject_list.labelSearchSubSubjects}
								</label>
							</div>
						</div>
					</div>
					<div class="clearfix"></div>
	
					<#-- Bouton "Rechercher" -->
					<input type="hidden" name="page" value="${path_label}">
					<input type="hidden" value="${faq.id}" name="faq_id">
					<button class="btn btn-14rem btn-white-on-green" type="submit">
						<i class="glyphicon glyphicon-search"></i>&nbsp;#i18n{helpdesk.subject_list.buttonLabelSearch}
					</button>
					
				</div>
			</div>
		</form>
	</div>	

	<#-- *********************************************************************************** -->
	<#-- * RESULTS RESULTS RESULTS RESULTS RESULTS RESULTS RESULTS RESULTS RESULTS RESULTS * -->
	<#-- * RESULTS RESULTS RESULTS RESULTS RESULTS RESULTS RESULTS RESULTS RESULTS RESULTS * -->
	<#-- *********************************************************************************** -->

	<div class="container">
		<#if search_page>
			<#if helpdesk_question_answer_list?has_content>
				<ul id="questionAnswer">
					<#list helpdesk_question_answer_list as questionAnswer>
						<li>
							<h2 class="sub-title"><@getParentSubject subject=questionAnswer.getSubject(plugin) breadcrumb="" /></h2>
							<a name="${questionAnswer.idQuestionAnswer}"></a>
							<h3 class="title2">${questionAnswer.question}</h3>
							<blockquote>${questionAnswer.answer}</blockquote>
						</li>
					</#list>
				</ul>
			<#else>
				<blockquote>#i18n{helpdesk.message.search_nok}</blockquote>
			</#if>
		<#else>
			<@subjectsList items=helpdesk_subject_list typeList="questionAnswer" depth=0 />
		</#if>
	</div>

	<form action="" method="post">
		<input type="hidden" name="page" value="${path_label}">
		<input type="hidden" name="faq_id" value="${faq.id}">
		<input type="hidden" name="contact" value="contact">
		<div class="form-group">
			<p class="form-control-static text-center">
				<strong>#i18n{helpdesk.subject_list.labelNoAnswer} <a href="https://sollicitations.paris.fr/ticketing/jsp/site/Portal.jsp?page=mylutece&action=login">cliquez sur ce lien pour poser votre question</a></strong>
				<#if false><!-- Supprimé par JPO, remplacé par un lien vers le formulaire de question MIB -->
					<button class="btn btn-default" type="submit">
						<i class="fa fa-envelope"></i> #i18n{helpdesk.subject_list.labelContact}
					</button>
				</#if>
			</p>
		</div>
	</form>
</div>